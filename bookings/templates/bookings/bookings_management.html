{% extends "base.html" %}

{% load crispy_forms_tags %}

{% block extra_js %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.jquery.com/ui/1.13.1/jquery-ui.min.js"></script>
{% endblock %}

{% block content %}

{% if user.is_superuser %}
  <div class="row">
    <div class="booking-page col-sx-12 col-md-6">
      <div class="text-center manage-bookings">
        <div>
          <h2>Manage Bookings</h2>
          <form class="form-inline float-right">
            <input class="form-control mr-sm-2" type="text" placeholder="Search by guest" name="search">
            <button class="btn my-2 my-sm-0" type="submit">Find Booking</button>
          </form>
        </div>

        <div class="btn-group mr-2" role="group">
          <a href="?filter=all" class="btn">All</a>
          <a href="?filter=day" class="btn">Today</a>
          <a href="?filter=week" class="btn">This week</a>
        </div>
        <hr>

        {% if grouped_results %}
          <div class="booking-list-scroller">
            <div class="container">
              {% for result in grouped_results %}
              <h3>{{ result.day|date:"F d" }}</h3>
              <div class="booking-book">
                {% for booking in result.bookings %}
                  <div class="card booking-card">
                      <a href="{% url 'edit_booking' booking_id=booking.id %}">
                        <div>{{ booking.user.username|slice:"-10:" }}</div>
                        <div>Table # {{ booking.table.number }}</div>
                        <div>{{ booking.size_of_party }} <i class="fa-solid fa-user-group"></i></div>
                        <div>{{ booking.start_time|time:"g:i A" }}</div>
                      </a>
                  </div>
                {% endfor %}
              </div>
              <hr>
              {% endfor %}
            </div>
          </div>
          {% else %}
          <p>No bookings found.</p>
          {% endif %}

      </div>
    </div> 

    <div class="booking-page col-sx-12 col-md-6">
      <h2>Seating plan</h2>
      <form method="POST" id="table-form">
        {% csrf_token %}
        {{ table_form|crispy }}
        <button type="submit">Add Table</button>
      </form>

      <div id="room-map">
        <img class="col-12" id="floor-plan" src="/static/media/floorplan-min.jpg" alt="Byte table map">
        <div class="draggable-item">Item 1</div>
        <div class="draggable-item">Item 2</div>
        <div class="draggable-item">Item 3</div>
      </div>

        <div class="container table-list">
          {% for table in tables %}
          <div class="table-item">
            T {{ table.number }}|Seating for {{ table.size }} 
            <a href="{% url 'delete_table' table_id=table.id %}" class="btn delete-button">
              X
            </a>
          </div>
      {% endfor %}
    </div>

  </div>
    <script>  
      // JavaScript code to update the value display element
      var slider = document.getElementById('id_size_of_party');
      var sliderValue = document.getElementById('slider_value');

      sliderValue.innerHTML = slider.value; // Initial value

      slider.oninput = function() {
      sliderValue.innerHTML = this.value;
      };
    </script>
{% else %}
    <script>
        window.location.href = "{% url 'home' %}";
    </script>
{% endif %}
    <script>
      $(document).ready(function() {
        $(".draggable-item").draggable({
          containment: "#room-map",
          snap: "#room-map",
          drag: function(event, ui) {
            ui.position.left = Math.round(ui.position.left / 10) * 10;
            ui.position.top = Math.round(ui.position.top / 10) * 10;
          }
        });
      });
    </script>
{% endblock %}
